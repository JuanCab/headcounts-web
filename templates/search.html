{% extends "base.html" %}

{% block title %}Course Search - Minnesota State University Moorhead{% endblock %}

{% block head %}
{{ super() }}
{% endblock %}

{% block content %}
<div class="content-wrapper">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="row justify-content-center mb-4">
                <div class="col-lg-8">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show animate-fade-in" role="alert">
                            <i class="fas fa-{% if category == 'success' %}check-circle{% elif category == 'error' %}exclamation-circle{% elif category == 'warning' %}exclamation-triangle{% else %}info-circle{% endif %} me-2"></i>
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endif %}
    {% endwith %}

    <div class="row justify-content-center">
        <div class="col-12 col-xl-10">
            <div class="search-card animate-fade-in">
                <div class="card-header-custom">
                    <h2><i class="fas fa-search me-3"></i>Course Search</h2>
                </div>
                <div class="form-container">
                    <form action="{{ url_for('search') }}" method="POST" id="courseSearchForm">
                        {{ form.hidden_tag() }}

                        <!-- Primary Search Criteria -->
                        <div class="form-section">
                            <h4><i class="fas fa-university"></i>Primary Search Criteria</h4>
                            <div class="row g-4">
                                <div class="col-md-4" id="subjectContainer">
                                    {{ form.subject_or_college.label(class="form-label") }}
                                    {{ form.subject_or_college(class="form-select" + (" is-invalid" if form.subject_or_college.errors else "")) }}
                                    {% if form.subject_or_college.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.subject_or_college.errors %}
                                                <i class="fas fa-exclamation-circle me-1"></i>{{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-3" id="classCodeContainer">
                                    {{ form.class_code.label(class="form-label") }}
                                    {{ form.class_code(class="form-control" + (" is-invalid" if form.class_code.errors else "")) }}
                                    <small class="text-muted wildcard-note">
                                        <i class="fas fa-info-circle me-1"></i>Use _ as wildcard (e.g., 241_ for all courses starting with 241)
                                    </small>
                                    {% if form.class_code.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.class_code.errors %}
                                                <i class="fas fa-exclamation-circle me-1"></i>{{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-5" id="courseTypeContainer">
                                    {{ form.course_type.label(class="form-label") }}
                                    {{ form.course_type(class="form-select" + (" is-invalid" if form.course_type.errors else "")) }}
                                    {% if form.course_type.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.course_type.errors %}
                                                <i class="fas fa-exclamation-circle me-1"></i>{{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Time Period Section -->
                        <div class="form-section">
                            <h4><i class="fas fa-calendar-alt"></i>Time Period</h4>
                            <div class="row g-4">
                                <div class="col-md-6">
                                    {{ form.semester.label(class="form-label") }}
                                    {{ form.semester(class="form-select" + (" is-invalid" if form.semester.errors else "")) }}
                                    {% if form.semester.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.semester.errors %}
                                                <i class="fas fa-exclamation-circle me-1"></i>{{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-6">
                                    {{ form.year.label(class="form-label") }}
                                    {{ form.year(class="form-select" + (" is-invalid" if form.year.errors else "")) }}
                                    {% if form.year.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.year.errors %}
                                                <i class="fas fa-exclamation-circle me-1"></i>{{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="mt-3">
                                <div class="alert alert-info" role="alert">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Note:</strong> When you submit the search, if either semester or year is set to "All", both will be set to "All" to include all available terms. 
                                    The default selection is the upcoming semester (Fall 2025).
                                </div>
                            </div>
                        </div>

                        <!-- Submit Buttons -->
                        <div class="text-center mt-4">
                            <button type="submit" class="btn btn-search">
                                <i class="fas fa-search me-2"></i>Search Courses
                            </button>
                            <button type="button" class="btn btn-reset" id="resetBtn">
                                <i class="fas fa-undo me-2"></i>Reset
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='script.js') }}"></script>
{% endblock %}